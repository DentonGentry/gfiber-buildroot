#!/bin/sh
mkdir -p /tmp/cwmp

if [ -e /etc/platform ]; then
    BOARDTYPE="$(cat /etc/platform)"
else
    BOARDTYPE="gfmedia"
fi

#Convert to lower case: no tr command and bash 4.0 support
BOARDTYPE="$(python convert.py lower $BOARDTYPE)"

CWMP="
  /usr/catawampus/cwmpd
      --platform=$BOARDTYPE
      --ping_ip6dev=br0
      --ca-certs=/etc/ssl/certs/ca-certificates.crt
      --restrict-acs-hosts=gfiber-acs-staging.appspot.com,gfiber-acs-prod.appspot.com,gfiber-acs-canary.appspot.com,gfiber-acs-boss.appspot.com,.gfsvc.com,.google.com
"

if [ -s /tmp/ssl/certs/device.pem ] && [ -s /tmp/ssl/private/device.key ]; then
  CWMP="$CWMP --client-cert=/etc/ssl/certs/device.pem"
  CWMP="$CWMP --client-key=/etc/ssl/private/device.key"
fi

exec $CWMP "$@"
