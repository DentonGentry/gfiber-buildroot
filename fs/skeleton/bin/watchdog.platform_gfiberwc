#!/bin/sh

sigterm()
{
	# Stop on close.
	echo 'V' >&3
	3>&-
	exit 0
}

wait-until-created /dev/watchdog

# ioclt uses strtol to convert ioctlnr, so negative numbers must be used when
# MSB is set.
WDIOC_SETTIMEOUT=-1073457402	# 0xc0045706

# Max timeout for QCA9533 is 171s
ioctl -l 4 -- /dev/watchdog $WDIOC_SETTIMEOUT 70
exec 3<> /dev/watchdog
trap sigterm TERM

while true ; do
	echo >&3
	sleep 5
done
