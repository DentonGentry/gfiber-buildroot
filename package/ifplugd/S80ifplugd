#!/bin/sh

start()
{
  if is-fiberjack; then
    babysit 60 ifplugd -i pon0 -n -s -f -I -q -d0 2>&1 | logos ifplugd &
  fi
  if is-network-box; then
    babysit 60 ifplugd --api-mode=iff -i wan0 -n -s -f -I -q -d0 2>&1 | logos ifplugd &
  fi
}

stop()
{
  ifplugd -k -W -i pon0
  ifplugd -k -W -i wan0
  pkill ifplugd.action
}

case "$1" in
  start)
    start
    ;;
  stop)
    stop
    ;;
  restart)
    stop
    start
    ;;
  sleep)
    sleep 60
    ;;
  *)
    echo "Usage: $0 {start|stop|restart}"
    exit 1
    ;;
esac

exit 0
